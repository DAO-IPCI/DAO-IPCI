# Инструкция по первому взаимодействию в рамках DAO, в блокчейне Ethereum.

Для того, чтобы предложить услугу на рынке DAO, у Airalab создан специальный контракт `Offer`. Оферта представляет из себя подобие общепринятой оферты на услуги, но в формате автономного контракта в блокчейне. Чтобы её принять нужно будет совершить ниже описанные действия. Для работы будем использовать клиент Etherem сети - `Ethereum Wallet`.

Скачать его можно по ссылке, в разделе `Downloads`: [Ethereum Wallet](https://github.com/ethereum/mist/releases)

## Статусы кошелька

Если вы не знаете как определить, синхронизирован кошелек или нет, предлагаю скриншоты с описанием ниже:

### Не синхронизированный кошелек:

![Screenshot 1](/img/Screenshot_1.png)

Обращаем внимание на информацию между `Send` и `Contracts`. Там указано, по-порядку: количество пиров, количество загруженных блоков, время от последнего загруженного блока. Если у вас количество пиров равно 0, то для начала нужно подождать несколько минут. Ethereum использует пиринговые сети, подобно Torrent. На поиск пиров может уйти некоторое время. Если пиры не находятся, нужно, в первую очередь посмотреть не закрыт ли порт 30030, а также не установлены ли ограничения на пиринговые сети в вашей локальной сети. Или обратитесь к системному администратору.

### Кошелек в стадии синхронизации

![Screenshot 2](/img/Screenshot_2.png)

Если в поле информации появились `%` и шкала загрузки, то кошелек находится в процессе синхронизации. Этот процесс может занять много времени. Рекомендуется использовать систему с SSD, т.к. основная нагрузка идет на накопитель данных.

### Синхронизированный кошелек

![Screenshot 3](/img/Screenshot_3.png)

Когда шкала загрузки пропадет, и справа, в поле информации, можно будет увидеть отсчет в секундах от времени последнего блока, кошелек синхронизирован. В сети Ethereum блоки появляются в среднем, раз в 16 секунд. Обращайте внимание, на эту информацию. Если в поле отсчета от последнего блока будут цифры выше одной,двух минут, это может говорить о проблемах с соединением.

## Начало работы с DAO

### Добавление токенов

Т.к. любое DAO имеет свои внутренние токены-кредиты, используемые как средство расчета внутри DAO, нам нужно будет добавить их в список просматриваемых токенов. Для этого перейдем в раздел `Contracts`, кликнув по нему.

Список всех модулей DAO, включая токен `Credits`, хранится в контракте DAO Core, а также по адресу: [Airalab modules](https://github.com/airalab/DAO-Airalab)

Если вы знаете как работать с DAO Core, его адрес: `0xf38a9052cc162fab081dc8177a8f74a53f0da989`, [JSON interface](https://github.com/airalab/core/blob/master/abi/modules/Core.json), возмите адрес `Credits` оттуда. Если нет, с Github.

Сейчас нас интересует модуль `Credits`, его адрес - `0x4bc13752568B99036692bA8B1dB2c97d6Df457f4`

Чтобы добавить токен `Credits` в список наблюдаемых, нажмем кнопку `Watch Token` внизу раздела `Contracts`.

![Screenshot 4](/img/Screenshot_4.png)

Затем, вставим адрес `Credits` в строку `TOKEN CONTRACT ADDRESS`.

![Screenshot 5](/img/Screenshot_5.png)

Таким же образом добавим хранилище Ether, `Ether Leger`, его адрес `0x15d2b79ded1dd856070fc68e9ff4c1896934b14f`

### Добавление автономных контрактов

Оферта, в качестве оплаты принимает внутренние токены Airalab DAO - `AIR`. Чтобы поменять Ether на Air, существует модуль `Market`. На нем ожно обменивать токены. Адрес `Market` хранится в DAO Core. Если вы не знаете как работать с DAO Core, привожу адрес `Market` ниже:
`0xFE7D3D1b1749863F8a3F24c9ACC0AF282109F416`, [JSON interface](https://raw.githubusercontent.com/airalab/core/master/abi/modules/Market.json)

Добавим автономный контракт `Market` в список наблюдаемых. Для этого нажмем кнопку `Watch contract` в разделе `Contracts`.

![Screenshot 6](/img/Screenshot_6.png)

Назовем его `Airalab Market`, вставим адрес и JSON interface, указанные выше. Контракт появится в списке наблюдаемых.

Далее, нам необходимо добавить автономный контракт `Offer`, который и представляет из себя оферту и контракты токенов `Airalab Ether leger`, `Airalab Credits` он нам понадобится для взаимодествия с `Market`.  
Адреса и JSON interface:

Address `Offer`: `ждем`  
[JSON interface](https://raw.githubusercontent.com/airalab/core/master/abi/modules/Offer.json)

Address `Airalab Ether leger`: `0x15d2b79ded1dd856070fc68e9ff4c1896934b14f`  
[JSON interface](https://raw.githubusercontent.com/airalab/core/master/abi/modules/TokenEther.json)

Address `Airalab Credits`: `0x4bc13752568B99036692bA8B1dB2c97d6Df457f4`  
[JSON interface](https://raw.githubusercontent.com/airalab/core/master/abi/modules/TokenEmission.json)

Добавим эти автономные контракты в список наблюдаемых контрактов, таким же способом, что и `Market`.

## Работа с контрактами

Чтобы принять оферту, нам необходимо поменять имеющиеся у нас `ETH` на внутренние токены Airalab - `AIR`. Для этого будем использовать модуль `Market`, который мы добавили в список наблюдаемых в предыдущей части. Он представляет из себя реестр лотов на покупку/продажу различных токенов. Откроем `Market`, кликнув по нему в разделе `Contracts`.

![Screenshot 7](/img/Screenshot_7.png)

В разделе `Read from contract` можно увидеть:

* First - адрес первого лота.
* Size - кол-во лотов.

Пока на рынке есть только один лот, он нам и нужен. Его адрес - `0xab15D337be4Bb066d5FA1bbA3805856983a3ef1F`. Лот, это тоже автономный контракт и чтобы с ним взаимодействовать, нужно добавить его в список наблюдаемых. Адрес указан выше, интерфейс - [JSON interface](https://raw.githubusercontent.com/airalab/core/master/abi/modules/Lot.json)  
Добавим его в список наблюдаемых контрактов и откроем.

![Screenshot 8](/img/Screenshot_8.png)

В разделе `Read from contract` можно увидеть:

* Seller - адрес продавца
* Closed - флаг открытого/закрытого лота
* Quantity sale - кол-во продаваемых токенов
* Sale - адрес продаваемого токена
* Buyer - адрес покупателя(пока лот не закрыт, он будет пустой)
* Quantity buy - кол-во покупаемых токенов
Buy - адрес покупаемого токена

Исходя из этих данных, мы можем сделать вывод, что на рынке на продажу выставлено 1000 AIR за 61 ETH.  
>(61 ETH = 61000000000000000000 Wei)

Контракт `Lot`, может работать только с токенами, поэтому нам нужно токенизировать ETH, находящиеся у нас на счету. Для этого просто отправим ETH на адрес `Airalab Ether Leger`.

![Screenshot 9](/img/Screenshot_9.png)

После этой операции, нам нужно "позволить" контракту `Lot` снять необходимую сумму с контракта токена `Airalab Ether Leger` для закрытия лота.

Откроем контракт `Airalab Ether Leger`

![Screenshot 10](/img/Screenshot_10.png)

Нас интересует раздел `Write to contract`. Выберем в выпадающем списке функцию `Approve`. Заполняем:  

* Address - адрес `Lot` 
* Value - кол-во разрешенных к снятию токенов - 61 ETH - 61000000000000000000 Wei   

Исполняем контракт нажатием кнопки `Execute`. Теперь контракт `Lot` сможет снять с вашего счета токены ETH, для своего исполнения. Откроем его:

![Screenshot 11](/img/Screenshot_11.png)

Нас интересует раздел `Write to contract`. Выберем в выпадающем списке функцию `Deal`. Заполняем:  

* Address - адрес покупателя, т.е. ваш адрес в сети Ethereum.

Исполняем контракт нажатием кнопки `Execute`.

После того, как транзакция будет замайнена с вашего счета в `Ether Leger` будет списано указанно кол-во ETH, а на ваш счет в `Airalab Credits` перейдут 1000 `AIR`. Можно приступать к принятию оферты.

Откроем контракт `Offer`, который мы добавили в список наблюдаемых в предыдущей части.

![Screenshot 12](/img/Screenshot_12.png)

В разделе `Read from contract` можно увидеть:

* Signer - здесь можно проверить принимал ли конкретный адрес эту оферту
* Beneficiary - адрес бенефициара
* Value - цена принятия
* Closed - если оферта закрыта, там будет время, когда это случилось
* Description - описание предлагаемой услуги
* Hard offer - адрес для твердой оферты
* Token - адрес принимаемого в качестве оплаты токена

> Чтобы принять оферту, нужно сделать `Approve`, для нее в контракте `Airalab Credits` тем же способом, что описывался для ETH. Не забудьте это сделать.

В разделе `Write to contract`. Выберем в выпадающем списке функцию `Accept`. Исполняем контракт нажатием кнопки `Execute`.

Если вы не забыли сделать `Approve`, то 1000 AIR уйдут `Beneficiary` и оферта будет принята.
